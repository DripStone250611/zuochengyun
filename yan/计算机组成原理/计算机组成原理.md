## 第 2 章 数据的表示和运算

### 2.3 浮点数的表示和运算

#### 2.3.1 浮点数的表示

**3. 浮点数的规格化**

尾数的位数决定浮点数的有效数位，有效数位越多，数据的精度越高。为了在浮点数运算的过程中尽可能多的保留有效数字的位数，使有效数字尽量占满尾数数位，必须在运算过程中对浮点数进行规格化操作。

**规格化操作：**是指通过调整一个非规格化浮点数的尾数和阶码的大小，使非零的浮点数在尾数的最高数位上保证是一个有效值。

 **左规：**当运算结果的尾数的最高数位不是有效位时，需要进行左规。左规时，尾数每左移一位、阶码减一（基数为2时），直至尾数变为规格化形式为止。左规可能会进行很多次。

**右规：**当运算结果的尾数的有效位进到小数点前面时，需要进行右规。将尾数右移一位、阶码加一，需要右规时，只需进行一次。

**4、IEEE 754 标准**

**32位单精度格式：**符号（1位）、阶码（8位）、尾数（23位），阶码偏置值127，尾数存在一个隐藏位，尾数实际有24位有效数字。

**64位双精度格式：**符号（1位）、阶码（11位）、尾数（52位），阶码偏置值为1023

阶码全零或全一有特别的解释（+0，-0，-∞，+∞）

**5、定点、浮点表示的区别**

（1）数值的表示范围

若定点数与浮点数的字长相同，则浮点表示法所能表示的数值范围远大于定点表示法。

（2）精度

对于字长相同的定点数和浮点数来说，浮点数扩大了数的表示范围，但是精度降低了

（3）数的运算

浮点数包括阶码和尾数两个部分，运算时不仅要做尾数的运算，还要做阶码的运算，运算结果要求规格化，比较复杂。

（4）溢出问题

在定点运算中，当运算结果超出书的表示范围时，发生溢出；浮点运算时，运算结果超出尾数表示范围却不一定溢出，只有规格化后阶码超过所能表示的范围时，才发生溢出。

#### 2.3.2 浮点数的加减运算

浮点数的加减运算分为以下几步：

**1、对阶**

对阶的目的是使两个操作数的小数点位置对齐，即使得两个数得阶码相等。为此，先求阶差，然后以小阶向大阶看起的原则，将阶码小的尾数右移一位，阶加一，直到两个数的阶码相等为止。尾数右移时，舍掉有效位会产生误差，影响精度。

**2、尾数求和**

将对阶后的尾数按定点数的加减运算规则运算。运算后的尾数不一定是规格化的，因此，浮点数的加减运算需要进一步进行规格化处理。

**3、规格化**

**4、舍入**

在对阶和尾数右规时，可能会对尾数进行右移，为保证运算精度，一般将低位移出的两位保留下来，参加中间过程的运算，最后将运算结果进行舍入。

常见的舍入方法有：0舍1入法、恒置1法、截断法。

**0舍1入法：**运算结果保留位的最高数位为0，则舍去；最高数位为1，则在尾数的末位加1.这样可能会使尾数溢出，此时需要再做一次右规。

**恒置1法：**只要因移位而丢失的位中有1，就把尾数末位置1，而不管原来是0还是1。

**截断法：**直接截取所需位数，丢弃后面所有的位。

**5、溢出判断**

若一个正指数超过了最大允许值（127或1023），则发生指数上溢，产生异常。若一个负指数超过了最小允许值（-149或-1074）则发生指数下溢，通常把结果当成0来处理。

1、右规和位数舍入时，需要检查是否溢出。

2、左规。

**6、C语言中的浮点数类型**

`char->int->long->double`和`float->double`强制类型转换没有精度损失。

- `int->float`  不会发生溢出，但是精度会受损失
- `double->float`  可能会发生溢出，可能精度会受到损失



#### 2.3.3 习题

**一、单选**

|  1   |  2   |  3   |  4   |  5   |
| :--: | :--: | :--: | :--: | :--: |
|  C   |  B   |  B   |  C   | B(C) |
|  6   |  7   |  8   |  9   |  10  |
|  B   |  C   | C(A) |  B   | A(D) |
|  11  |  12  |  13  |  14  |  15  |
|  D   |  D   |  D   | C(D) |  A   |
|  16  |  17  |  18  |  19  |  20  |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |
|      |      |      |      |      |

